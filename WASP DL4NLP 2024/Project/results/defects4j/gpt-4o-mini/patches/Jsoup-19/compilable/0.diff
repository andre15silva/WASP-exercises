diff --git a/tmp/21638050-940a-4dac-8f37-19e391872ef9_buggy.java b/tmp/09cc163f-9054-4777-af36-0c7fe72990a4_fixed.java
index 4aff4e4..ecdf192 100644
--- a/tmp/21638050-940a-4dac-8f37-19e391872ef9_buggy.java
+++ b/tmp/09cc163f-9054-4777-af36-0c7fe72990a4_fixed.java
@@ -1,15 +1,19 @@
 private boolean testValidProtocol(Element el, Attribute attr, Set<Protocol> protocols) {
     // try to resolve relative urls to abs, and optionally update the attribute so output html has abs.
     // rels without a baseuri get removed
     String value = el.absUrl(attr.getKey());
-        if (!preserveRelativeLinks)
+    if (!preserveRelativeLinks) {
         attr.setValue(value);
-        
+    } else {
+        // Only preserve the attribute value if it is not absolute and is a valid protocol
+        if (!value.equals(attr.getValue()) && !protocols.isEmpty()) {
             for (Protocol protocol : protocols) {
                 String prot = protocol.toString() + ":";
-            if (value.toLowerCase().startsWith(prot)) {
-                return true;
+                if (attr.getValue().toLowerCase().startsWith(prot)) {
+                    return true; // Preserve if it matches a valid custom protocol
                 }
             }
-        return false;
+        }
+    }
+    return false; // Return false if no valid protocols match
 }
\ No newline at end of file
