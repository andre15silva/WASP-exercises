diff --git a/tmp/db83654f-0e2a-443a-82a8-2b0938e8310b_buggy.java b/tmp/98ccb01d-6d83-409e-836c-c05357131868_fixed.java
index a37dc7a..78c0e59 100644
--- a/tmp/db83654f-0e2a-443a-82a8-2b0938e8310b_buggy.java
+++ b/tmp/98ccb01d-6d83-409e-836c-c05357131868_fixed.java
@@ -1,10 +1,15 @@
     protected void addChildren(int index, Node... children) {
         Validate.noNullElements(children);
         ensureChildNodes();
+        int last = index;
         for (int i = children.length - 1; i >= 0; i--) {
             Node in = children[i];
+            if (in.getOwnerDocument() != getOwnerDocument()) {
+                in = in.duplicate();
+            }
             reparentChild(in);
             childNodes.add(index, in);
+            last = index;
         }
-        reindexChildren(index);
+        reindexChildren(last);
     }
\ No newline at end of file
