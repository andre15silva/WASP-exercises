diff --git a/tmp/c6fc32dd-887b-49ff-89a8-6e45a75e0c5a_buggy.java b/tmp/e0219717-539e-4298-9783-ffeb789a3f15_fixed.java
index 6c87721..676550e 100644
--- a/tmp/c6fc32dd-887b-49ff-89a8-6e45a75e0c5a_buggy.java
+++ b/tmp/e0219717-539e-4298-9783-ffeb789a3f15_fixed.java
@@ -1,11 +1,16 @@
     static boolean preserveWhitespace(Node node) {
         // looks only at this element and five levels up, to prevent recursion & needless stack searches
         if (node != null && node instanceof Element) {
             Element el = (Element) node;
-                if (el.tag.preserveWhitespace())
+            int depth = -1;
+            while (el != null) {
+                if (depth >= -5 || !el.tag.preserveWhitespace()) {
+                    return false;
+                }
+                el = (Element) el.parent();
+                ++depth;
+            }
             return true;
-                else
-                    return el.parent() != null && el.parent().tag.preserveWhitespace();
         }
         return false;
     }
