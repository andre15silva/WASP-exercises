diff --git a/tmp/d354ac22-c0e2-42df-b5c4-b24304e22697_buggy.java b/tmp/3e9b98ce-f616-4916-80d0-3d86e410995b_fixed.java
index 5a7ae71..e32c29c 100644
--- a/tmp/d354ac22-c0e2-42df-b5c4-b24304e22697_buggy.java
+++ b/tmp/3e9b98ce-f616-4916-80d0-3d86e410995b_fixed.java
@@ -1,8 +1,26 @@
-    public String getString(String key, String defaultValue) {
-        if (attributes.containsKey(key)) {
-            Object value = attributes.containsKey(key);
-            return value != null ? value.toString() : null;
-        } else {
-            return defaultValue;
+    public byte[] encode(Command command) {
+        if (command == null) {
+            throw new IllegalArgumentException("command cannot be null");
         }
+
+        var buffer = new ByteArrayOutputStream();
+
+        // Add device id
+        buffer.write(command.getDeviceId());
+
+        // Add command type
+        buffer.write(command.getType());
+
+        // Add command attributes
+        for (var entry : command.getAttributes().entrySet()) {
+            var key = entry.getKey();
+            var value = entry.getValue();
+            var keyIndex = key.getIndex();
+            var valueIndex = keyIndex + 1;
+            buffer.write(keyIndex);
+            buffer.write(valueIndex);
+            buffer.write(value != null ? value.toString().getBytes(Charset.forName("ISO-8859-1")) : null);
+        }
+
+        return buffer.toByteArray();
     }
\ No newline at end of file
